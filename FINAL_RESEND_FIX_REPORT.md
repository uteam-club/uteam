# üéØ –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Å–æ–æ–±—â–µ–Ω–∏–π

## üìã –ü—Ä–æ–±–ª–µ–º–∞
**–û—à–∏–±–∫–∞ 500 –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ" –¥–ª—è RPE –æ–ø—Ä–æ—Å–æ–≤**

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã
1. **‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç endpoint `/send-rpe-survey` –≤ Telegram –±–æ—Ç–µ**
2. **‚ùå Next.js API –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç RPE –æ–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ –±–æ—Ç–∞**
3. **‚úÖ Endpoint `/send-morning-survey` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω Telegram –±–æ—Ç (`telegram-bot/bot_direct_db.py`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handle_send_rpe_survey()`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω endpoint `/send-rpe-survey` –≤ —Ä–æ—É—Ç–µ—Ä
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç–∏ (—Ä—É—Å—Å–∫–∏–π/–∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ trainingId –¥–ª—è RPE –æ–ø—Ä–æ—Å–æ–≤

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω Next.js API (`src/app/api/surveys/rpe/route.ts`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–∞ –∏ –∫–æ–º–∞–Ω–¥—ã –∏–∑ –ë–î
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–æ—Ç—É
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram ID –∏–≥—Ä–æ–∫–∞

### 3. –°–æ–∑–¥–∞–Ω—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- ‚úÖ `test-all-fixes.py` - –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ `test-local-fixes.py` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º –±–æ—Ç–æ–º
- ‚úÖ `test-bot-simple.py` - —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç
- ‚úÖ `debug-api-endpoints.py` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ API endpoints

## üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –õ–æ–∫–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –±–æ—Ç
```
ü§ñ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–æ—Ç–∞
‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω: running
   Endpoints: ['morning', 'rpe', 'success']

üì§ –¢–µ—Å—Ç 1: –£—Ç—Ä–µ–Ω–Ω–∏–π –æ–ø—Ä–æ—Å
   –°—Ç–∞—Ç—É—Å: 200 ‚úÖ
   –û—Ç–≤–µ—Ç: {"success": true}

üì§ –¢–µ—Å—Ç 2: RPE –æ–ø—Ä–æ—Å  
   –°—Ç–∞—Ç—É—Å: 200 ‚úÖ
   –û—Ç–≤–µ—Ç: {"success": true}
```

### ‚úÖ Next.js API
```
üåê –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Next.js API
üì§ –¢–µ—Å—Ç: –£—Ç—Ä–µ–Ω–Ω–∏–π –æ–ø—Ä–æ—Å —á–µ—Ä–µ–∑ Next.js API
   –°—Ç–∞—Ç—É—Å: 401 (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - –æ–∂–∏–¥–∞–µ–º–æ)

üì§ –¢–µ—Å—Ç: RPE –æ–ø—Ä–æ—Å —á–µ—Ä–µ–∑ Next.js API
   –°—Ç–∞—Ç—É—Å: 401 (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - –æ–∂–∏–¥–∞–µ–º–æ)
```

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫ —Ä–µ–∞–ª—å–Ω–æ–º—É –±–æ—Ç—É
```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –±–æ—Ç
pkill -f "bot_direct_db.py"

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)
# - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è handle_send_rpe_survey()
# - –î–æ–±–∞–≤–ª–µ–Ω endpoint –≤ —Ä–æ—É—Ç–µ—Ä

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
cd telegram-bot
python bot_direct_db.py
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Next.js —Å–µ—Ä–≤–µ—Ä
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å–µ—Ä–≤–µ—Ä (Ctrl+C)
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
npm run dev
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É
1. –ó–∞–π—Ç–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
2. –í—ã–±—Ä–∞—Ç—å –∫–æ–º–∞–Ω–¥—É —Å –∏–≥—Ä–æ–∫–∞–º–∏
3. –ù–∞–∂–∞—Ç—å "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ" –¥–ª—è RPE –æ–ø—Ä–æ—Å–∞
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏—à–ª–æ –∏–≥—Ä–æ–∫—É

## üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –±–æ—Ç–∞
```bash
curl http://158.160.189.99:8080/status
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ endpoints
```bash
# –£—Ç—Ä–µ–Ω–Ω–∏–π –æ–ø—Ä–æ—Å
curl -X POST http://158.160.189.99:8080/send-morning-survey \
  -H "Content-Type: application/json" \
  -d '{"telegramId":"123","clubId":"test","teamId":"test","date":"2024-01-15"}'

# RPE –æ–ø—Ä–æ—Å
curl -X POST http://158.160.189.99:8080/send-rpe-survey \
  -H "Content-Type: application/json" \
  -d '{"telegramId":"123","clubId":"test","teamId":"test","date":"2024-01-15"}'
```

### –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```bash
python test-all-fixes.py
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ" —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —É—Ç—Ä–µ–Ω–Ω–∏—Ö –æ–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ" —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è RPE –æ–ø—Ä–æ—Å–æ–≤  
- ‚úÖ –ò–≥—Ä–æ–∫–∏ –ø–æ–ª—É—á–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ 500 –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üéØ –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|--------|----------|
| Telegram –±–æ—Ç | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω | –î–æ–±–∞–≤–ª–µ–Ω endpoint /send-rpe-survey |
| Next.js API | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω | –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | ‚úÖ –ì–æ—Ç–æ–≤–∞ | –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é |

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –±–æ—Ç—É**
2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã**
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ**
4. **–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏–≥—Ä–æ–∫–∏ –ø–æ–ª—É—á–∞—é—Ç —Å–æ–æ–±—â–µ–Ω–∏—è**

---

**–î–∞—Ç–∞:** 25 —Å–µ–Ω—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é  
**–ê–≤—Ç–æ—Ä:** AI Assistant
