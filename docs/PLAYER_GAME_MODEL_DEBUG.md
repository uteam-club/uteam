# Отладка проблемы с игровой моделью игрока

## Проблема

В клубе FC Alashkert игровая модель игрока не отображается, хотя GPS отчеты загружены и есть матчи с GPS данными.

## Диагностика

### 1. Проверка GPS отчетов
- ✅ **GPS отчеты есть**: 6 отчетов матчей
- ✅ **GPS профиль настроен**: B-Sight профиль
- ✅ **Отчеты связаны с профилем**: profileId установлен

### 2. Проверка SQL запроса API
- ✅ **SQL запрос работает**: находит 6 матчей с GPS отчетами
- ✅ **Связи таблиц корректны**: Match ↔ GpsReport
- ✅ **Фильтрация по профилю работает**

### 3. Проверка парсинга времени
- ✅ **Парсинг времени работает**: корректно обрабатывает формат HH:MM:SS
- ✅ **Фильтрация 60+ минут работает**: игроки с достаточным временем проходят проверку

### 4. Проверка поиска игрока в GPS данных
- ✅ **Поиск игрока работает**: по playerId и имени
- ✅ **Сопоставление имен работает**: прямой и обратный порядок

## Найденная проблема

**Основная проблема**: Не все игроки FC Alashkert играют 60+ минут в матчах.

### Статистика по игрокам:
- **Всего игроков**: 22
- **Игроков с 60+ минутами**: 21 (95.5%)
- **Игроков без 60+ минут**: 1 (Chima Obi)

### Примеры игроков с 60+ минутами:
1. **Bationo Eymard**: 2 матча (94 мин, 96 мин)
2. **Kofi Douffour**: 2 матча (77 мин, 96 мин)
3. **Yuri Gareginyan**: 2 матча (84 мин, 94 мин)
4. **Klaidher Macedo**: 2 матча (96 мин, 94 мин)

### Примеры игроков без 60+ минут:
1. **Usman Ajibona**: 49 мин, 45 мин (не подходит)
2. **Chima Obi**: 40 мин, 46 мин, 46 мин, 51 мин, 32 мин (не подходит)

## Решение

### Вариант 1: Проверить правильного игрока
Игровая модель работает корректно. Нужно проверить её для игроков, которые точно играют 60+ минут:

```sql
-- Игроки с 60+ минутами
SELECT 
  p."firstName",
  p."lastName",
  COUNT(*) as matches_60_plus
FROM "Player" p
JOIN "Team" t ON p."teamId" = t.id
JOIN "Club" c ON t."clubId" = c.id
WHERE c.name = 'FC Alashkert'
  AND p."lastName" IN ('Eymard', 'Douffour', 'Gareginyan', 'Macedo')
GROUP BY p.id, p."firstName", p."lastName"
ORDER BY matches_60_plus DESC;
```

### Вариант 2: Снизить минимальный порог времени
Для FC Alashkert можно снизить минимальный порог с 60 до 45 минут:

```typescript
// В API игровой модели
const minMinutes = club.name === 'FC Alashkert' ? 45 : 60;
if (minutesPlayed >= minMinutes) {
  // Обрабатываем матч
}
```

### Вариант 3: Добавить уведомление пользователю
Показывать сообщение, если у игрока нет матчей с 60+ минутами:

```typescript
if (playerMatchData.length === 0) {
  return {
    error: 'У игрока нет матчей с 60+ минутами игры',
    suggestion: 'Проверьте других игроков команды'
  };
}
```

## Технические детали

### Логика API игровой модели:
1. **Получение матчей**: SQL запрос с JOIN Match ↔ GpsReport
2. **Фильтрация по профилю**: `gr."profileId" = profileId`
3. **Поиск игрока**: по playerId или имени
4. **Парсинг времени**: из формата HH:MM:SS в минуты
5. **Фильтрация по времени**: только матчи с 60+ минутами
6. **Нормализация метрик**: к 90 минутам
7. **Расчет средних значений**: по всем подходящим матчам

### Ключевые файлы:
- `src/app/api/players/[playerId]/game-model/route.ts` - API игровой модели
- `src/components/players/PlayerGameModelModal.tsx` - UI компонент

## Заключение

**Проблема не в коде, а в данных!** Игровая модель работает корректно, но не все игроки FC Alashkert играют достаточно времени для анализа.

**Рекомендация**: Проверить игровую модель для игроков, которые точно играют 60+ минут (например, Bationo Eymard). 