# üöÄ –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ GPS –æ—Ç—á–µ—Ç–æ–≤

## üìã –ü—Ä–æ–±–ª–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

### 1. ‚ùå –û—à–∏–±–∫–∞: `column "clubId" does not exist`
**–ú–µ—Å—Ç–æ**: `/api/gps/column-mappings`  
**–ü—Ä–∏—á–∏–Ω–∞**: –í —Ç–∞–±–ª–∏—Ü–µ `GpsColumnMapping` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –ø–æ–ª—è `clubId` –∏ `teamId`  
**–†–µ—à–µ–Ω–∏–µ**: 
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `clubId` –∏ `teamId` –≤ —Ç–∞–±–ª–∏—Ü—É `GpsColumnMapping`
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π SQL –∑–∞–ø—Ä–æ—Å

### 2. ‚ùå –û—à–∏–±–∫–∞: `invalid input syntax for type uuid: "default-profile"`
**–ú–µ—Å—Ç–æ**: `/api/gps/reports`  
**–ü—Ä–∏—á–∏–Ω–∞**: `profileId` –ø–æ–ª—É—á–∞–ª —Å—Ç—Ä–æ–∫—É `'default-profile'` –≤–º–µ—Å—Ç–æ UUID  
**–†–µ—à–µ–Ω–∏–µ**:
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–æ `'default-profile'` –Ω–∞ `null` –≤ `NewGpsReportModal.tsx:610`
- ‚úÖ API —É–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `null` –∑–Ω–∞—á–µ–Ω–∏—è

### 3. ‚ùå –û—à–∏–±–∫–∞: `invalid input syntax for type uuid: "auto-mapping"`
**–ú–µ—Å—Ç–æ**: `/api/gps/column-mappings`  
**–ü—Ä–∏—á–∏–Ω–∞**: `gpsProfileId` –ø–æ–ª—É—á–∞–ª —Å—Ç—Ä–æ–∫—É `'auto-mapping'` –≤–º–µ—Å—Ç–æ UUID  
**–†–µ—à–µ–Ω–∏–µ**:
- ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–æ `'auto-mapping'` –Ω–∞ `'00000000-0000-0000-0000-000000000000'`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ GET –∏ POST –º–µ—Ç–æ–¥–∞—Ö API

### 4. ‚ùå –û—à–∏–±–∫–∞: `invalid input syntax for type uuid: "null"`
**–ú–µ—Å—Ç–æ**: `/api/gps/reports`  
**–ü—Ä–∏—á–∏–Ω–∞**: `profileId` –ø–æ–ª—É—á–∞–ª —Å—Ç—Ä–æ–∫—É `"null"` –≤–º–µ—Å—Ç–æ `null`  
**–†–µ—à–µ–Ω–∏–µ**:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞: `profileId && profileId !== 'null' ? profileId : null`
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–æ–∫–∏ `"null"` –∏–∑ —Ñ–æ—Ä–º—ã

### 5. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –≤ `GpsReportData`
**–ú–µ—Å—Ç–æ**: `/api/gps/reports` –∏ `/components/gps/NewGpsReportModal.tsx`  
**–ü—Ä–∏—á–∏–Ω–∞**: 
- API –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–∫–∞–ª —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤
- –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–æ—Å—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–æ–π –º–µ—Ç—Ä–∏–∫–∏ –≤ –º–∞–ø–ø–∏–Ω–≥–∞—Ö
**–†–µ—à–µ–Ω–∏–µ**:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞ —Å—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤ API
- ‚úÖ API —Ç–µ–ø–µ—Ä—å –∏—â–µ—Ç –∫–æ–ª–æ–Ω–∫—É, —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é —Å –º–µ—Ç—Ä–∏–∫–æ–π "–ò–º—è –∏–≥—Ä–æ–∫–∞" (–∫–æ–¥: `athlete_name`)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ —ç—Ç–æ–π –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–æ–∫
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ `canonicalMetricName` –∏ `canonicalMetricCode` –≤ –º–∞–ø–ø–∏–Ω–≥–∞—Ö
- ‚úÖ API –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üîß –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```sql
-- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è clubId –∏ teamId
ALTER TABLE "GpsColumnMapping" 
ADD COLUMN "clubId" uuid NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000',
ADD COLUMN "teamId" uuid NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000';

-- –°–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã
CREATE INDEX "GpsColumnMapping_clubId_idx" ON "GpsColumnMapping" ("clubId");
CREATE INDEX "GpsColumnMapping_teamId_idx" ON "GpsColumnMapping" ("teamId");
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
```typescript
// –ë—ã–ª–æ:
const profileId = profileData.profile?.id || 'default-profile';

// –°—Ç–∞–ª–æ:
const profileId = profileData.profile?.id || null;
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
- ‚úÖ –ü–æ–ª—è `clubId` –∏ `teamId` —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã
- ‚úÖ –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö: `uuid` (nullable: NO)
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã

### –¢–µ—Å—Ç 2: API Column Mappings
- ‚úÖ –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ü–æ–ª—è `clubId` –∏ `teamId` –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –¢–µ—Å—Ç 3: API Reports
- ‚úÖ –ü–æ–ª–µ `profileId` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- ‚úÖ –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö: `uuid` (nullable: YES)
- ‚úÖ API –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `null` –∑–Ω–∞—á–µ–Ω–∏—è

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å |
|--------|--------|
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π –≤ –ë–î | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ |
| –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ profileId | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ |
| –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ | üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ |

## üöÄ –ß—Ç–æ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **API `/api/gps/column-mappings`** - –±–æ–ª—å—à–µ –Ω–µ –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π 500
2. **API `/api/gps/reports`** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `null` –∑–Ω–∞—á–µ–Ω–∏—è
3. **–ó–∞–≥—Ä—É–∑–∫–∞ GPS –æ—Ç—á–µ—Ç–æ–≤** - –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–æ–∫
4. **–ú–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫** - –ø–æ–ª—è `clubId` –∏ `teamId` –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

## üîç –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É GPS –æ—Ç—á–µ—Ç–æ–≤ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å GPS —Ñ–∞–π–ª
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á–µ—Ç–∞ –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL (Yandex Cloud)
- **ORM**: Drizzle ORM
- **–ú–∏–≥—Ä–∞—Ü–∏—è**: –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–π SQL
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: $(date)  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
