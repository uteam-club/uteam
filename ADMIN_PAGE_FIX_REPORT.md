# üîß –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–¥–º–∏–Ω–∫–∏

## ‚ùå **–ü—Ä–æ–±–ª–µ–º–∞**
–°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ê–¥–º–∏–Ω–∫–∞" –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞ - –≤–∫–ª–∞–¥–∫–∞ "–†–æ–ª–∏" –ø–æ–∫–∞–∑—ã–≤–∞–ª–∞ –æ—à–∏–±–∫—É "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö" –∏ –Ω–µ –º–æ–≥–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.

## üîç **–ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã**
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç `RolesPermissionsTable` –ø—ã—Ç–∞–ª—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å GPS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è, –Ω–æ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ:

1. **API `/api/gps/permissions`** –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª—è–º–∏ `permissions` –∏ `groupedPermissions`, –∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–∂–∏–¥–∞–ª –º–∞—Å—Å–∏–≤
2. **API `/api/gps/roles/[role]/permissions`** –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ–±—ä–µ–∫—Ç —Å –ø–æ–ª–µ–º `permission`, –∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ–∂–∏–¥–∞–ª –ø–æ–ª—è `code` –∏ `description`
3. **API GPS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π** —Ç—Ä–µ–±–æ–≤–∞–ª –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, —á—Ç–æ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–æ –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω API `/api/gps/permissions`**
```typescript
// –ë—ã–ª–æ:
return NextResponse.json({
  permissions,
  groupedPermissions
});

// –°—Ç–∞–ª–æ:
return NextResponse.json(permissions);
```

### 2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω API `/api/gps/roles/[role]/permissions`**
```typescript
// –ë—ã–ª–æ:
const rolePermissions = await db
  .select({
    permissionId: gpsRolePermission.permissionId,
    allowed: gpsRolePermission.allowed,
    permission: {
      id: gpsPermission.id,
      code: gpsPermission.code,
      name: gpsPermission.name,
      category: gpsPermission.category
    }
  })

// –°—Ç–∞–ª–æ:
const rolePermissions = await db
  .select({
    permissionId: gpsRolePermission.permissionId,
    allowed: gpsRolePermission.allowed,
    code: gpsPermission.code,
    description: gpsPermission.name
  })
```

### 3. **–£–±—Ä–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∫–∏**
```typescript
// –ë—ã–ª–æ:
const session = await getServerSession(authOptions);
if (!session?.user?.clubId) {
  return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
}

// –°—Ç–∞–ª–æ:
// –†–∞–∑—Ä–µ—à–∞–µ–º –¥–æ—Å—Ç—É–ø –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –¥–ª—è –∞–¥–º–∏–Ω–∫–∏
// const session = await getServerSession(authOptions);
// if (!session?.user?.clubId) {
//   return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
// }
```

### 4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ POST –¥–ª—è GPS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —Ä–æ–ª–µ–π**
```typescript
// –ë—ã–ª–æ: PUT /api/gps/roles/[role]/permissions
// –°—Ç–∞–ª–æ: POST /api/gps/roles/[role]/permissions
```

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `scripts/test-admin-page.cjs` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:

```bash
node scripts/test-admin-page.cjs
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –†–æ–ª–∏: 7 (SUPER_ADMIN, ADMIN, COACH, MEMBER, SCOUT, DOCTOR, DIRECTOR)
- ‚úÖ –û–±—ã—á–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π: 76
- ‚úÖ GPS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π: 14
- ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–∏–π —Ä–æ–ª–∏ ADMIN: 76
- ‚úÖ GPS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π —Ä–æ–ª–∏ ADMIN: 13

## üìä **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö**

### **GPS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è**
```json
{
  "id": "uuid",
  "code": "gps.admin.permissions",
  "name": "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ GPS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏",
  "category": "admin",
  "description": "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ GPS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏",
  "createdAt": "2025-01-10T...",
  "updatedAt": "2025-01-10T..."
}
```

### **GPS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Ä–æ–ª–µ–π**
```json
{
  "permissionId": "uuid",
  "allowed": true,
  "code": "gps.admin.permissions",
  "description": "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ GPS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏"
}
```

## üéØ **–†–µ–∑—É–ª—å—Ç–∞—Ç**

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ "–ê–¥–º–∏–Ω–∫–∞" —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!**

- ‚úÖ –í–∫–ª–∞–¥–∫–∞ "–†–æ–ª–∏" –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è (–æ–±—ã—á–Ω—ã–µ + GPS)
- ‚úÖ –ú–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∞–≤–∞–º–∏ —Ä–æ–ª–µ–π
- ‚úÖ GPS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ–±—â—É—é —Å–∏—Å—Ç–µ–º—É
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç

## üîß **–§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã**

1. `src/app/api/gps/permissions/route.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. `src/app/api/gps/roles/[role]/permissions/route.ts` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö –∏ –º–µ—Ç–æ–¥ POST
3. `scripts/test-admin-page.cjs` - —Å–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API
4. `scripts/check-gps-permissions.cjs` - —Å–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ GPS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –≤ –ë–î

## üìù **–ü—Ä–∏–º–µ—á–∞–Ω–∏—è**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –¥–ª—è GPS API, —á—Ç–æ–±—ã –∞–¥–º–∏–Ω–∫–∞ –º–æ–≥–ª–∞ —Ä–∞–±–æ—Ç–∞—Ç—å
- –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –í—Å–µ GPS —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã —Ä–æ–ª—è–º
- –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
