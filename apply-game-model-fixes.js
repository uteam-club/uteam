#!/usr/bin/env node

/**
 * –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏–≥—Ä–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
 * 
 * –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
 * 1. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
 * 2. –£–¥–∞–ª—è–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –∏–≥—Ä–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π
 * 3. –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∏–≥—Ä–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
 */

const { execSync } = require('child_process');
const path = require('path');

console.log('üîß –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –∏–≥—Ä–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π...\n');

try {
  // 1. –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é
  console.log('üìä –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...');
  execSync('npx drizzle-kit push', { 
    stdio: 'inherit',
    cwd: process.cwd()
  });
  console.log('‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∞\n');

  // 2. –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –ø–µ—Ä–µ—Å—á–µ—Ç–∞
  console.log('üîÑ –ü–µ—Ä–µ—Å—á–µ—Ç –∏–≥—Ä–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π...');
  execSync('node -e "require(\'./src/lib/game-model-calculator.ts\')"', {
    stdio: 'inherit',
    cwd: process.cwd()
  });
  console.log('‚úÖ –ò–≥—Ä–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã\n');

  console.log('üéâ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!');
  console.log('\nüìã –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:');
  console.log('  ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ (playerId, clubId)');
  console.log('  ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫ 1 –º–∏–Ω—É—Ç–µ)');
  console.log('  ‚úÖ –ó–∞–º–µ–Ω–µ–Ω DELETE+INSERT –Ω–∞ UPSERT');
  console.log('  ‚úÖ –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã –∏–≥—Ä–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π');
  console.log('  ‚úÖ –ü–µ—Ä–µ—Å—á–∏—Ç–∞–Ω—ã –≤—Å–µ –º–æ–¥–µ–ª–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π');

} catch (error) {
  console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:', error.message);
  process.exit(1);
}
